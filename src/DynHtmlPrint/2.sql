INSERT INTO
    XF_DYNHTMLPRINT (
        XF_PRODUCT,
        XF_DOCTYPE,
        XF_FORMID,
        XF_SYNTAX1,
        XF_SYNTAX2,
        XF_SYNTAX3,
        XF_SYNTAX4,
        XF_SYNTAX5,
        XF_SYNTAX6,
        XF_SYNTAX7,
        XF_SYNTAX8,
        XF_SYNTAX9,
        XF_LASTMODTIME,
        XF_SYNTAX10
    )
VALUES (
        N'TTPOS.DESKTOP',
        N'SALESINV',
        N'HI',
        N'<#include "SalesHtmlPrintUtilHK.ftl"><#function isMergeItem item><#local y8goldmergeprinteable = StorePro(''y8goldmergeprinteable'', salesData.orgId, salesData.storeCode, salesData.tillId)!''0''><#if y8goldmergeprinteable == ""><#local y8goldmergeprinteable = ''1''></#if><#local y8goldmergeprinteable = ''1''><#local y8GoldMergePrintEnable = y8goldmergeprinteable == ''1''><#local purchGoldItemCodes = StorePro(''goldpurchaseonly'', salesData.orgId, salesData.storeCode, salesData.tillId)!'''' purchGoldItemCodesArr = []><#if purchGoldItemCodes != ""><#local purchGoldItemCodesArr = purchGoldItemCodes?split(",")![]></#if><#return item?? && purchGoldItemCodesArr?seq_contains(item.itemCode) && y8GoldMergePrintEnable></#function><#macro PrintGoldPrices><#local group4 = ""><#local group4Arr = []><#list extra.salesItem as item><#if item.group24 == ''G''><#local localArr = item.group4Local![]><#local localCode = ''''><#if (localArr?size > 0)><#local localCode = localArr[0].valueCode!></#if><#if !(group4Arr?seq_contains(localCode)) || isMergeItem(item)><#if localCode!= ''''><#if !(group4Arr?seq_contains(localCode))><#local group4Arr = group4Arr + [localArr[0].valueCode]></#if></#if><#if group4 != item.group4 || isMergeItem(item)><#local group4 = item.group4><#local group4Desc = group4><#list item.group4Local![] as local><#if local.langType == l',
        N'anguage><#local group4Desc = local.valueDesc></#if></#list><#if (item.goldPriceType!"") == "2"><#local goldPriceType = Translate("GoldBuyingPricePerGramHI")><#local goldPrice = item.goldPurchPrice?default(0)><#elseif (item.goldPriceType!"") == "3"><#local goldPriceType = Translate("GoldBuyingPricePerGramHI")><#local goldPrice = item.goldExchPrice?default(0)><#else><#local goldPriceType = Translate("GoldSellingPricePerGramHI")><#local goldPrice = item.goldSellPrice?default(0)></#if><#if isMergeItem(item)><#local goldPriceType=Translate("GoldSellingPricePerGramHIForY8")></#if><#local goldPrice = goldPrice><#local memoType = salesData.salesTotal.memoType><#if isMergeItem(item)><#local memoType = item.subMemoType></#if><#switch memoType><#case "1"><#case "3"><line>${(group4Desc)!} ${goldPriceType} ${Translate(currency)} ${goldPrice?string[amountFmt]}/${Translate("gram")}</line><#break><#case "2"><#if (item.goldPriceType!"") == "2" || (item.goldPriceType!"") == "3"><line>${(group4Desc)!} ${goldPriceType} ${Translate(currency)} ${goldPrice?string[amountFmt]}/${Translate("gram")}</line></#if><#break><#case "4"><tr><td colspan="3"><line>${Translate("Today")}: ${(group4Desc)!} ${goldPriceType} ${Translate(currency)} ${goldPrice?string[amountFmt]}/${Translate("gram")}</line></td></tr><#break><#default><#break></#switch></',
        N'#if></#if></#if></#list></#macro><#macro PrintItemCurRemark item><#local isPrint=StorePro(''printsalesitemremark'', salesData.orgId, salesData.storeCode, salesData.tillId)!''0''><#if isPrint==""><#local isPrint=''0''></#if><#if item.extraInfo?? && item.extraInfo.itemRemark?? && isPrint==''1''><tr><td colspan="6" ln-info><#list item.extraInfo.itemRemark?split(";") as r>${r!}<br></#list></td></tr></#if></#macro><#assign pageTop=170 priceFmt="#,##0.0" qtyFmt="#,##0.000" amountFmt="#,##0.0" dateFmt="yyyy-MM-dd" timeFmt="HH:mm:ss" datetimeFmt="yyyy-MM-dd HH:mm" parse_datetime="yyyy-MM-dd HH:mm:ss" itemGroup24=""><#setting date_format=dateFmt><#setting time_format=timeFmt><#setting datetime_format=datetimeFmt><#assign sd=salesData><#assign st=sd.salesTotal><@initVar /><@initVarTSL /><!DOCTYPE html><@SalesHtmlHeader /><style>.list-header-wrapper {height: 3mm;position: relative}.list-header-wrapper .list-header {position: absolute;bottom: 0}pageContent,paper {position: relative !important}.item-row {page-break-inside: avoid}.item-row[page-break-after] {page-break-after: always}</style><body class=header-bg><#assign memoType=st.memoType!""><#if st.irsCode??><#assign pageTop=(pageTop+10)></#if><#if memoType?? && memoType==''4''><#assign pageTop=(pageTop+10)></#if><#if extra?? && extra.salesItem?? && extra.salesItem?size gt 0><#assi',
        N'gn itemGroup24=extra.salesItem[0].group24!""><#if (st.isDeposit!"") !="1"><#assign memoType=extra.salesItem[0].subMemoType!""></#if></#if><@assignDocHasPosQtyItem /><#assign exGoldMemo=memoType==''3'' && (extra.salesItem[0].group24!"")==''G''><paper config=''{"height":"210mm", "width":"297mm", "margin":{"top": "${(pageTop)!}", "bottom":80, "left":0, "right":0 }, "backgroundImage":"${(backgroundImage)!}", "insertsAfter":"${(insertsAfter)!}"}''><pageheader id=pageHeader><structure direction=horizontal sections=2><#list 1..2 as x><section class=page-header><div style="text-align:right;padding:0 2rem 1rem 0"><div><@PrintMemoTitle /></div><div>Set No. ${extra.curSetNo!""} of ${extra.totalSetNo!""}</div><div class=page-number>P. <span class=pageNumber></span> of <span class=totalPages></span></div></div><content><div class=memo-header-qr><#if (eInvoiceQRCodes![])?size gt 0><#if (eInvoiceTopRemark![])?size gt 0><p>${eInvoiceTopRemark?first}</p></#if> <img class=invoice-qr src="data:image/png;base64,${BarcodeBase64(''png'', ''QR_CODE'', eInvoiceQRCodes?first, 200, 200)}"><#if (eInvoiceBottomRemark![])?size gt 0><p>${eInvoiceBottomRemark?first}</p></#if></#if></div><#assign memoHeaderInfoPadding=''3rem'' /><#if memoType==''4''><#assign memoHeaderInfoPadding=''1rem'' /></#if><div class=memo-header-info style="padding-bottom:${memoHeaderI',
        N'nfoPadding}"><div>${(printTitle)!}</div><div>${(storeName)!} - ${(sd.storeTel)!}</div><div class=store-addr>${(extra.storeAddressLangMap[language])!storeAddress}</div><div>${Translate("TxDatetime")}: ${(txDatetime)!?datetime}</div><div>${Translate("TxNo")}: ${(storeCode)!}-${(docNo)!}</div><#if st.irsCode??><div>${Translate("IrsNo")}: ${(st.irsCode)!}</div></#if><#if st.customerCode??><div>${Translate("TslMember")}: ${(st.customerCode)!}</div></#if></div><#if memoType==''4''><div class=customer-info style=padding-bottom:1rem><@PrintDepositCustomerInfo /></div></#if><div class=list-header-wrapper><table class=list-header border-line=bottom><#if itemGroup24=="G"><#switch memoType><#case "1"><#case "4"><tr><td width=30%><td width=20%><td align=right width=25%>${Translate("LabourShopCom")}<td align=right width=25%><tr><td>${Translate("Item")}<td align=right>${Translate("NetWeight")}<td align=right>(${Translate((''header_''+currency))} ${Translate("PerPiece")})<td align=right>${Translate("Total")}(${Translate((''header_''+currency))})</tr><#break><#case "2"><#case "3"><tr><td width=40%>${Translate("Item")}<td align=right width=20%>${Translate("NetWeight")}<td align=right width=40%>${Translate("Total")}(${Translate(''header_''+currency)})</tr><#break><#case "5"><tr><td align=right width=100%>${Translate("Total")}(${Translate(',
        N'''header_''+currency)})</tr><#break></#switch><#else><@jwColNames /></#if></table></div></content></section></#list></structure></pageheader><pagecontent id=pageContent><structure direction=horizontal sections=2><#list 1..2 as x><section><table class=list-body collapse=true><#if memoType==''5''><tr><td width=40%>${Translate("RefundDepostAmt")}<td align=right width=45%>${Translate(currency)} ${((st.netAmt?abs)?string[amountFmt])!}<tr><td>${Translate("OriginalDepositTender")}<td align=right></tr><#list sd.salesTender as tender><tr><td>${tender.tenderDesc} (${tender.tenderCode})<td align=right>${Translate(tender.currCode)} ${((tender.payAmt)?string[amountFmt])!}</tr></#list><tr><td>${Translate("OriginalDepositMemoNo")}${(st.extra.memoRefundDocNo)!}<td align=right></tr><#else><#assign totalNetAmt=0><#list extra.salesItem?default([]) as item><#if !item.extraInfo?? || !item.extraInfo.nonPrintItem?? || item.extraInfo.nonPrintItem==false><#assign netAmt=item.calcInfo.netAmt!0><#assign totalNetAmt +=netAmt><#assign prevMemoType = ''''><#if itemGroup24=="G"><#if isMergeItem(item)><#assign prevMemoType = memoType><#assign memoType = item.subMemoType></#if><#switch memoType><#case "1"><#case "4"><tr><td width=30% align=left>${Translate("Item")}:${item.itemCode}<td width=20% align=right>${(item.qty?string[qtyFmt])!}<@PrintSalesUni',
        N't item=item /></td><#if (item.handlingFee!0)==0><td width=25%></td><#else><td width=25% align=right>${Translate(currency)} ${((item.handlingFee-(item.calcInfo.discountTotal!0))?string[amountFmt])!}</td></#if><#if item.groupNetAmt??><td width=25% align=right>${Translate(currency)} ${(item.groupNetAmt?string[amountFmt])!}</td><#else><td width=25%></td></#if><tr><td colspan=2 align=left><@PrintItemDesci item=item /></td><#if (item.commissionAmt!0) !=0><td align=right>${Translate(currency)} ${(item.commissionAmt?string[amountFmt])!}</td></#if></tr><@PrintItemRemark item=item /><#break><#case "2"><tr><td align=left width=40%>${Translate("Item")}:${item.itemCode}<td align=right width=20%>${(item.qty?string[qtyFmt])!}<@PrintSalesUnit item=item /><td align=right width=40%>${Translate(currency)} ${(item.calcInfo.netAmt?string[amountFmt])!}<tr><td colspan=3><@PrintItemDesci item=item /></tr><@PrintItemRemark item=item /><#break><#case "3"><#assign itemAmt=-item.amount?default(0)><#assign itemQty=-item.qty?default(0)><#assign wastageAmt=-item.wastageAmt?default(0)><#assign commissionAmt=-item.commissionAmt?default(0)><#assign netWeight=itemQty - item.wastage?default(0)><tr><td width=40% align=left>${Translate("Item")}:${item.itemCode}<td width=20%><td width=40%><tr><td colspan=3 align=left><@PrintItemDesci item=item /></tr',
        N'><@PrintItemRemark item=item /><tr><td align=left>${Translate("TtlPurchaseWeight")}<td align=right>${(itemQty?string[qtyFmt])!}<@PrintSalesUnit item=item /><td align=right><tr><td align=left style=padding-left:2.1rem>${Translate("Wastage")}<td align=right>${(item.wastage?default(0)?string[qtyFmt])!}<@PrintSalesUnit item=item /><td align=right><tr><td align=left>${Translate("NetWeight")}<td align=right>${(netWeight?string[qtyFmt])!}<@PrintSalesUnit item=item /><#if prevMemoType != '''' && prevMemoType != item.subMemoType><td></#if><td align=right>${Translate(currency)}<#if exGoldMemo>${((-((commissionAmt!0) + (-item.groupNetAmt!0)?abs))?string[amountFmt])!}<#else>${((-((item.unitPrice!0)?abs))?string[amountFmt])!}</#if><tr><td align=left>${Translate("DeductShopComm")}<#if prevMemoType != '''' && prevMemoType != item.subMemoType><td></#if><td colspan=2 align=right>${Translate(currency)} ${((-(commissionAmt?abs))?string[amountFmt])!}<tr><td align=left>${Translate("Total")}<#if prevMemoType != '''' && prevMemoType != item.subMemoType><td></#if><td colspan=2 align=right><#if item.groupNetAmt??>${Translate(currency)} ${((-(item.groupNetAmt)?abs)?string[amountFmt])!}</#if></tr><#break></#switch><#else><@jwColValues item=item /><tr><td colspan=3><@PrintItemDesci item=item /></tr><@PrintItemRemark item=item /></#if><#if memoTy',
        N'pe==''1''><#if item.printBomInfo?? && item.printBomInfo==1 && item.extraInfo?? && (item.extraInfo.bomList?default([]))?size gt 0><tr><td colspan=3 ln-info><#list item.extraInfo.bomPrintList as bomList><#list bomList as bom><div>${(bom)!}</div></#list></#list></tr></#if><@PrintItemCurRemark item=item /><#if item.extraInfo?? && item.extraInfo.discCode??><tr><td colspan=3 ln-info>${Translate("DiscCode")}: ${item.extraInfo.discCode.code!""}</tr></#if><#if item.extraInfo?? && item.extraInfo.promInfo??><#list item.extraInfo.promInfo as promInfo><tr><td colspan=2>${Translate("PromoDisc")}: ${promInfo.promId!""}</tr></#list></#if><#if (resCouponSettle?default([]))?size gt 0><#list resCouponSettle?sort_by("promId") as settle><#list settle.coupons?sort_by("batchNo") as coupon><tr><td colspan=3>${Translate("DiscCoupon")}: ${coupon.cpNo} -${(coupon.lessAmount?string[amountFmt])!}</tr></#list></#list></#if></#if><#if memoType==''2''><@PrintRefundLessDetails item=item /></#if><tr><td></tr></#if><#if prevMemoType != ''''><#assign memoType = prevMemoType><#assign prevMemoType = ''''></#if></#list></#if><tr></table><#if itemGroup24=="G"><#if memoType=="1" || memoType=="3"> <br><br><@PrintGoldPrices /> <br><br></#if></#if><table class=list-body collapse=true><tr><td width=60%><td><table class=list-body collapse=true border-line=top width=100%><#if st.extra?? && st.extra.ttlTaxAmt?? && st.extra.ttlTaxAmt gt 0><tr><td align=left>${Translate("Tax")}<td align=right>${(st.extra.ttlTaxAmt?string[amountFmt])}</tr></#if><tr><td align=left><#if memoType==''4''>${Translate("DepositAmount")}<#elseif memoType==''5''>${Translate("DepositRefund")}<#else>${Translate("ItemAmount")}</#if><td align=right>${Translate(currency)}<#if memoType==''4''>${(st.amtPaid?string[amountFmt])!}<#elseif memoType==''5''>${((st.amtPaid?abs)?string[amountFmt])!}<#else>${totalNetAmt?string[amountFmt]}</#if></table></table><br><br><br><table class=list-body collapse=true><@setColWidth [13,10,2] /><#if sd.salesItem?? && docHasPosQtyItem><@PrintTotalDiscount currency=currency /><@PrintNetAmount currency=currency /><tr><td colspan=2><br></tr></#if><tr><td colspan=2><table class=list-body border-line=bottom collapse=true><tr><td>${Translate("Tender")}</table><td></tr><#list sd.salesTender as tender><tr><td><line>${tender.tenderDesc} (${tender.tenderCode}) <#if tender.tenderType==3><#if tender.docRef??>(${Translate("CardNo")}${tender.docRef})</#if><!--Do not show when tender type is cheque--><#elseif tender.tenderType !=4><#if tender.buyExchRate?? && tender.currCode !=currency> (${Translate("exchRate")} ${tender.buyExchRate}) <#elseif tender.tenderType==9><#assign epsInfo=tender.docRef><#if tender.extra?? && tender.extra.docRef2?? && tender.extra.docRef2?has_content && tender.extra.docRef2?split(",")?? && tender.extra.docRef2?split(",")[0]?? && tender.extra.docRef2?split(",")[0]?has_content && tender.extra.docRef2?split(",")[0]?trim !="-EA"><#if epsInfo?? && epsInfo?has_content><#assign epsInfo +="," + tender.extra.docRef2?split(",")[0]><#else><#assign epsInfo +=tender.extra.docRef2?split(",")[0]></#if></#if><#if epsInfo?? && epsInfo?has_content> (Card No:${epsInfo}) <#else> (Card No) </#if><#elseif tender.extra?? && tender.extra.docRef2??> (${tender.extra.docRef2}) </#if></#if></line><td align=right><table class=list-body collapse=true><tr><td align=right>${Translate(tender.currCode)}<#if memoType==''5''>-</#if>${((tender.payAmt)?string[amountFmt])!}</td><#if tender.buyExchRate?? && tender.currCode !=currency><td align=right>${Translate(currency)}<#if memoType==''5''>-</#if>${((tender.baseAmt?abs)?string[amountFmt])!}</td></#if></table><td></tr></#list><#if memoType==''4''><tr><#if ((st.amtPaid - st.netAmt)> 0) ><td>${Translate("ChangeAmount")}</td><#else><td>${Translate("RemainAmount")}</td></#if><td align=right>${Translate(currency)} ${((st.netAmt - st.amtPaid)?string[amountFmt])!}<td></tr></#if> <!-- Hide AmountPaid and ChangeAmount when refund/void/exchangeGold --><#if memoType !=''2'' && !exGoldMemo && ',
        '2024-11-21 10:50:34.653',
        N'memoType !=''4'' && memoType !=''5''><tr><td width=45%><td width=40%><table class=list-body collapse=true border-line=top><@setColWidth [3,7] /><tr><td align=left>${Translate("AmountPaid")}<td align=right>${Translate(currency)} ${(st.amtPaid?string[amountFmt])!}<tr><td align=left>${Translate("ChangeAmount")}<td align=right>${Translate(currency)} ${(st.changeAmt?string[amountFmt])!}</table><td width=15%></tr></#if><#if (extra?? && extra.itemAutoRemark??)><#assign iaRems=extra.itemAutoRemark[language?substring(0,2)] /><#assign iaLn=[]><#list iaRems as iaRem><#assign iaLn=iaLn + iaRem.lines /></#list><#if (iaLn?size> 0)><tr><td colspan=3><div style="margin:2mm 0"><#list iaRems as iaRem><#if (iaRem.lines?size> 0)><div style=word-break:break-all><#list iaRem.lines as line><line>${line?replace(''\\n'',''<br/>'')}</line></#list></div></#if></#list></div><tr></#if></#if></table><table><@PrintDepositRemark /></table><table><@PrintMemoMessage /></table><#if (eInvoiceQRCodes![])?size gt 1><div><#if (eInvoiceTopRemark![])?size gt 0><p>${eInvoiceTopRemark?first}</p></#if><#list eInvoiceQRCodes as invoiceQR><#if invoiceQR?index gt 0> <img class=invoice-qr src="data:image/png;base64,${BarcodeBase64(''png'', ''QR_CODE'', invoiceQR, 200, 200)}"> </#if></#list></div></#if></section></#list></structure></pagecontent><pagefooter id=pageFooter><structure direction=horizontal sections=2><#list 1..2 as x><section><content><table snap=bottom><tr><line flex cust-sign><span>${Translate("Salesman")} ${extra.salesmanName!""} ${extra.salesmanCode!""}</span></line></table></content></section></#list></structure></pagefooter></paper>'
    );